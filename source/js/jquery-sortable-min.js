!function(f,t,l){function p(a,b){var c=Math.max(0,a[0]-b[0],b[0]-a[1]),d=Math.max(0,a[2]-b[1],b[1]-a[3]);return c+d}function q(a,b,c){for(var d=a.length,c=c?"offset":"position";d--;){var e=a[d].el?a[d].el:f(a[d]),i=e[c]();b[d]=[i.left,i.left+e.outerWidth(!0),i.top,i.top+e.outerHeight(!0)]}}function j(a,b){var c=b.offset();return{left:a.left-c.left,top:a.top-c.top}}function r(a,b,c){for(var b=[b.left,b.top],c=c&&[c.left,c.top],d,e=a.length,f=[];e--;)d=a[e],f[e]=[e,p(d,b),c&&p(d,c)];f=f.sort(function(a,
b){return a[1]-b[1]||a[2]-b[2]||a[0]-b[0]});return f[0]}function k(a){this.options=f.extend({},a);this.containers=[];this.childGroups=[];this.scrollProxy=f.proxy(this.scrolled,this);this.dragProxy=f.proxy(this.drag,this);this.dropProxy=f.proxy(this.drop,this);this.options.parentGroup?this.options.parentGroup.childGroups.push(this):this.placeholder=f(this.options.placeholder)}function m(a,b){this.el=a;this.childGroups=[];this.floatRight=!1;this.dragInitProxy=f.proxy(this.dragInit,this);this.options=
f.extend({},u,b);this.group=k.get(this.options);this.rootGroup=this.options.rootGroup=this.options.rootGroup||this.group;this.parentGroup=this.options.parentGroup=this.options.parentGroup||this.group;this.handle=this.options.handle||this.options.itemSelector;this.enable()}var h=f(t.document),u={itemSelector:"li",containerSelector:"ul",nested:!0,vertical:!0,drop:!0,placeholder:'<li class="placeholder"/>'},n={},s=0;Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);this.length=
0>a?this.length+a:a;return this.push.apply(this,c)};k.get=function(a){n[a.group]||(a.group||(a.group=s++),n[a.group]=new k(a));return n[a.group]};k.prototype={dragInit:function(a){h.on("mousemove",this.dragProxy);h.on("mouseup",this.dropProxy);this.item=f(a.target).closest(this.options.itemSelector);this.setPointer(a)},drag:function(a){a.preventDefault();this.dragging||(this.item.css({height:this.item.height(),width:this.item.width()}),this.item.addClass("dragged"),this.childContainers(this.item,
"disable"),this.dragging=!0);if(this.setPointer(a)){this.item.css(j(this.pointer,this.item.offsetParent()));var b=a.pageX,a=a.pageY,c=this.sameResultBox;(!c||c.top>a||c.bottom<a||c.left>b||c.right<b)&&this.processMove()}},drop:function(a){a.preventDefault();h.off("mousemove",this.dragProxy);h.off("mouseup",this.dropProxy);this.dragging&&(a=this.getContainer(this.placeholder),a.addItem(this.item,this.itemChildGroup),delete this.itemChildGroup,this.deleteDimensions(),this.placeholder.before(this.item).detach(),
this.item.removeClass("dragged").attr("style",""),this.childContainers(this.item,"enable"),this.dragging=!1,a.el.trigger("dropItem",[this.item,this]))},processMove:function(a,b){a||(a=this.relativePointer||this.pointer,b=this.lastRelativePointer||this.lastPointer);var c=r(this.getContainerDimensions(),a,b);if(c){c=this.containers[c[0]];if(!this.getOffsetParent())var d=c.getItemOffsetParent(),a=j(a,d),b=j(b,d);c.processMove(a,b)}},movePlaceholder:function(a,b,c){var d=this.lastAppendedItem;if(c||!(d&&
d[0]===a[0]))a[b](this.placeholder),this.lastAppendedItem=a,this.sameResultBox=c},getContainerDimensions:function(){this.containerDimensions||q(this.containers,this.containerDimensions=[],!this.getOffsetParent());return this.containerDimensions},getContainer:function(a){return a.closest(this.options.containerSelector).data("simpleDD")},getOffsetParent:function(){if(this.offsetParent===l){for(var a=this.containers.length-1,b=this.containers[a].getItemOffsetParent();a--;)if(b[0]!=this.containers[a].getItemOffsetParent()[0]){h.on("scroll",
this.scrolledProxy);b=!1;break}this.offsetParent=b}return this.offsetParent},setPointer:function(a){a={left:a.pageX,top:a.pageY};if(this.getOffsetParent()){var b=j(a,this.getOffsetParent());this.lastRelativePointer=this.relativePointer;this.relativePointer=b}this.lastPointer=this.pointer;this.pointer=a;return!0},addContainer:function(a){this.containers.push(a);delete this.containerDimensions},removeContainer:function(a){this.containers.remove(this.containers.indexOf(a));delete this.containerDimensions},
childContainers:function(a,b){for(var c=a.find(this.options.containerSelector),d=c.length;d--;){var e=c.eq(d).data("simpleDD");if(e&&e.parentGroup==e.rootGroup)e[b]()}},scrolled:function(){delete this.containerDimensions},deleteDimensions:function(){delete this.containerDimensions;for(var a=this.containers.length;a--;)delete this.containers[a].itemDimensions;for(a=this.childGroups.length;a--;)this.childGroups[a].deleteDimensions()}};m.prototype={dragInit:function(a){0===a.button&&(a.preventDefault(),
a.stopPropagation(),this.getItems(),this.rootGroup.dragInit(a,this))},processMove:function(a,b){var c=r(this.getItemDimensions(),a,b),d=this.rootGroup;if(c){var e=c[0],c=c[1];d.itemChildGroup===l&&this.items[e]===d.item[0]?(d.itemChildGroup=this.removeItem(d.item),this.processMove(a,b)):!c&&this.options.nested&&this.getContainerGroup(e)?this.getContainerGroup(e).processMove(a,b):this.movePlaceholder(e,a)}else d.movePlaceholder(this.el,"append")},movePlaceholder:function(a,b){var c=f(this.items[a]),
d=this.itemDimensions[a],e="after",i=c.outerWidth(),h=c.outerHeight(),g=c.offset(),g={left:g.left,right:g.left+i,top:g.top,bottom:g.top+h};this.options.vertical?b.top<=(d[2]+d[3])/2?(e="before",g.bottom-=h/2):g.top+=h/2:b.left<=(d[0]+d[1])/2!=this.floatRight?(e="before",g.right-=i/2):g.left+=i/2;this.rootGroup.movePlaceholder(c,e,g)},getItems:function(){this.items||(this.items=this.el.children(this.options.itemSelector).toArray());return this.items},getItemDimensions:function(){this.itemDimensions||
q(this.getItems(),this.itemDimensions=[]);return this.itemDimensions},getItemOffsetParent:function(){var a=this.el;return"relative"===a.css("position")||"absolute"===a.css("position")?a:a.offsetParent()},getContainerGroup:function(a){if(this.childGroups[a]===l){var b=f(this.items[a]).children(this.options.containerSelector);if(b[0]){var c=f.extend({},this.options,{parentGroup:this.group,group:s++}),b=b.simpleDD(c).data("simpleDD").group;this.childGroups[a]=b}else this.childGroups[a]=!1}return this.childGroups[a]},
addItem:function(a,b){this.items.push(a[0]);b&&(this.childGroups[this.items.length-1]=b)},removeItem:function(a){var a=this.items.indexOf(a[0]),b=this.childGroups[a];this.items.remove(a);this.childGroups.length>a&&this.childGroups.remove(a);delete this.itemDimensions;return b||!1}};var o={enable:function(){this.options.drop&&this.group.addContainer(this);this.el.on("mousedown",this.handle,this.dragInitProxy)},disable:function(){this.options.drop&&this.group.removeContainer(this);this.el.off("mousedown",
this.handle,this.dragInitProxy)}};f.extend(m.prototype,o);f.fn.simpleDD=function(a){var b=Array.prototype.slice.call(arguments,1);return this.each(function(){var c=f(this),d=c.data("simpleDD");d?o[a]&&o[a].apply(d,b):c.data("simpleDD",new m(c,a))})}}(jQuery,window);
